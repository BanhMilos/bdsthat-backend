generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Appointment {
  appointmentId BigInt              @id @default(autoincrement())
  propertyId    BigInt
  userId        BigInt
  listingId     BigInt
  status        appointment_status? @default(PENDING)
  datetime      DateTime            @db.Timestamptz(6)
  description   String?
  cancelReason  String?
  address       String?
  createdAt     DateTime?           @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?           @default(now()) @db.Timestamptz(6)
  Listing       Listing             @relation(fields: [listingId], references: [listingId], onDelete: NoAction, onUpdate: NoAction)
  Property      Property            @relation(fields: [propertyId], references: [propertyId], onDelete: NoAction, onUpdate: NoAction)
  User          User                @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)

  @@index([datetime], map: "idx_appointment_datetime")
  @@index([listingId], map: "idx_appointment_listing")
  @@index([userId], map: "idx_appointment_user")
}

model Area {
  areaId     BigInt    @id @default(autoincrement())
  name       String    @db.VarChar(255)
  type       area_type
  parentId   BigInt?
  latitude   Float?
  longitude  Float?
  isOldArea  Int?      @default(0)
  createdAt  DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime? @default(now()) @db.Timestamptz(6)
  Area       Area?     @relation("AreaToArea", fields: [parentId], references: [areaId], onDelete: NoAction, onUpdate: NoAction)
  other_Area Area[]    @relation("AreaToArea")
}

model Audit {
  auditId    BigInt       @id @default(autoincrement())
  objectId   BigInt
  objectType String       @db.VarChar(50)
  action     audit_action
  userId     BigInt
  timestamp  DateTime     @db.Timestamptz(6)
  details    Json?
  createdAt  DateTime?    @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime?    @default(now()) @db.Timestamptz(6)
  User       User         @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model Building {
  buildingId      BigInt       @id @default(autoincrement())
  projectId       BigInt?
  subdivisionId   BigInt?
  name            String       @db.VarChar(255)
  address         String?      @db.VarChar(255)
  numFloors       Int?
  numUnits        Int?
  approximateArea Decimal?     @db.Decimal(10, 2)
  unitsPerFloor   Int?
  numBasements    Int?
  description     String?
  images          Json?
  createdAt       DateTime?    @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime?    @default(now()) @db.Timestamptz(6)
  Project         Project?     @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
  Subdivision     Subdivision? @relation(fields: [subdivisionId], references: [subdivisionId], onDelete: NoAction, onUpdate: NoAction)
  Media           Media[]
  Panorama        Panorama[]
  Property        Property[]
}

model Category {
  categoryId     BigInt     @id @default(autoincrement())
  name           String     @db.VarChar(255)
  description    String?
  parentId       BigInt?
  createdAt      DateTime?  @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?  @default(now()) @db.Timestamptz(6)
  Category       Category?  @relation("CategoryToCategory", fields: [parentId], references: [categoryId], onDelete: NoAction, onUpdate: NoAction)
  other_Category Category[] @relation("CategoryToCategory")
  News           News[]
}

model ChatRoom {
  roomId                                  BigInt    @id @default(autoincrement())
  listingId                               BigInt?
  isActive                                Boolean?  @default(true)
  membersCount                            Int?      @default(0)
  lastMessageId                           BigInt?
  lastMessageAt                           DateTime? @db.Timestamptz(6)
  createdBy                               BigInt
  createdAt                               DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt                               DateTime? @default(now()) @db.Timestamptz(6)
  User                                    User      @relation(fields: [createdBy], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  Listing                                 Listing?  @relation(fields: [listingId], references: [listingId], onDelete: NoAction, onUpdate: NoAction)
  Message_ChatRoom_lastMessageIdToMessage Message?  @relation("ChatRoom_lastMessageIdToMessage", fields: [lastMessageId], references: [messageId], onDelete: NoAction, onUpdate: NoAction, map: "fk_chatroom_last_message")
  Member                                  Member[]
  Message_Message_roomIdToChatRoom        Message[] @relation("Message_roomIdToChatRoom")
}

model Comment {
  commentId BigInt          @id @default(autoincrement())
  newsId    BigInt?
  content   String?
  userId    BigInt?
  status    comment_status?
  createdAt DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt DateTime?       @default(now()) @db.Timestamptz(6)
  News      News?           @relation(fields: [newsId], references: [newsId], onDelete: NoAction, onUpdate: NoAction)
  User      User?           @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model Config {
  configId    BigInt    @id @default(autoincrement())
  key         String    @db.VarChar(255)
  value       String
  platform    String?   @db.VarChar(50)
  public      Int?      @default(1)
  description String?
  createdAt   DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime? @default(now()) @db.Timestamptz(6)
}

model Device {
  deviceId      BigInt    @id @default(autoincrement())
  userId        BigInt
  uuid          String    @db.VarChar(256)
  platform      String?   @db.VarChar(256)
  platformToken String?   @db.VarChar(2048)
  online        Int?      @default(0)
  granted       Int?      @default(0)
  ipAddress     String?   @db.VarChar(256)
  createdAt     DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime? @default(now()) @db.Timestamptz(6)
  User          User      @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model Document {
  documentId  BigInt               @id @default(autoincrement())
  userId      BigInt
  projectId   BigInt?
  propertyId  BigInt?
  title       String               @db.VarChar(255)
  description String?
  url         String               @db.VarChar(500)
  path        String?              @db.VarChar(500)
  type        document_type?
  legalType   document_legal_type?
  createdAt   DateTime?            @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime?            @default(now()) @db.Timestamptz(6)
  Project     Project?             @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
  Property    Property?            @relation(fields: [propertyId], references: [propertyId], onDelete: NoAction, onUpdate: NoAction)
  User        User                 @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)

  @@index([projectId], map: "idx_document_project")
  @@index([propertyId], map: "idx_document_property")
}

model FAQ {
  faqId     BigInt        @id @default(autoincrement())
  question  String        @db.VarChar(255)
  answer    String
  projectId BigInt?
  category  faq_category?
  status    faq_status    @default(ACTIVE)
  order     Int           @default(0)
  createdAt DateTime?     @default(now()) @db.Timestamptz(6)
  updatedAt DateTime?     @default(now()) @db.Timestamptz(6)
  Project   Project?      @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
}

model Favorite {
  favoriteId BigInt         @id @default(autoincrement())
  type       favorite_type? @default(LISTING)
  userId     BigInt
  propertyId BigInt?
  listingId  BigInt?
  newsId     BigInt?
  createdAt  DateTime?      @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime?      @default(now()) @db.Timestamptz(6)
  Listing    Listing?       @relation(fields: [listingId], references: [listingId], onDelete: NoAction, onUpdate: NoAction)
  Property   Property?      @relation(fields: [propertyId], references: [propertyId], onDelete: NoAction, onUpdate: NoAction)
  User       User           @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)

  @@index([listingId], map: "idx_favorite_listing")
  @@index([userId], map: "idx_favorite_user")
}

model Feedback {
  feedbackId BigInt    @id @default(autoincrement())
  userId     BigInt
  content    String
  rating     Int?
  createdAt  DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime? @default(now()) @db.Timestamptz(6)
  User       User      @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model Investor {
  investorId  BigInt    @id @default(autoincrement())
  name        String    @db.VarChar(255)
  address     String?   @db.VarChar(255)
  phone       String?   @db.VarChar(20)
  email       String?   @db.VarChar(255)
  website     String?   @db.VarChar(255)
  description String?
  createdAt   DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime? @default(now()) @db.Timestamptz(6)
  Project     Project[]
}

model Lead {
  leadId     BigInt       @id @default(autoincrement())
  email      String?      @db.VarChar(255)
  phone      String?      @db.VarChar(20)
  fullname   String?      @db.VarChar(255)
  source     String?      @db.VarChar(100)
  projectId  BigInt?
  status     lead_status? @default(NEW)
  assignedTo BigInt?
  notes      String?
  createdAt  DateTime?    @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime?    @default(now()) @db.Timestamptz(6)
  User       User?        @relation(fields: [assignedTo], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  Project    Project?     @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
}

model Listing {
  listingId       BigInt                 @id @default(autoincrement())
  propertyId      BigInt
  userId          BigInt
  title           String                 @db.VarChar(255)
  description     String?
  price           Decimal                @db.Decimal(15, 2)
  listingType     listing_type?
  status          listing_status?        @default(PENDING)
  createdAt       DateTime?              @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime?              @default(now()) @db.Timestamptz(6)
  verified        Int?                   @default(0)
  expirationDate  DateTime?              @db.Timestamptz(6)
  currency        String?                @default("VND") @db.VarChar(10)
  listingMessages Json?
  isFeatured      Int                    @default(0)
  views           Int?                   @default(0)
  priority        Int
  pushedDate      DateTime               @db.Timestamptz(6)
  creditSource    listing_credit_source?
  pushCount       Int                    @default(0)
  pushRemain      Int?                   @default(0)
  titleAI         String?                @db.VarChar(255)
  descriptionAI   String?
  Appointment     Appointment[]
  ChatRoom        ChatRoom[]
  Favorite        Favorite[]
  Property        Property               @relation(fields: [propertyId], references: [propertyId], onDelete: NoAction, onUpdate: NoAction)
  User            User                   @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  Payment         Payment[]
  Transaction     Transaction[]

  @@index([priority(sort: Desc)], map: "idx_listing_priority")
  @@index([propertyId], map: "idx_listing_property")
  @@index([pushedDate(sort: Desc)], map: "idx_listing_pushed_date")
  @@index([status], map: "idx_listing_status")
  @@index([listingType], map: "idx_listing_type")
  @@index([userId], map: "idx_listing_user")
}

model ListingPrice {
  priceId        BigInt    @id @default(autoincrement())
  priority       Int       @default(0)
  price          Float
  priceBeforeTax Float
  taxRate        Float
  description    String?
  durationDays   Int
  pushCount      Int       @default(0)
  currency       String?   @db.VarChar(10)
  createdAt      DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime? @default(now()) @db.Timestamptz(6)
}

model Media {
  mediaId                                 BigInt       @id @default(autoincrement())
  propertyId                              BigInt?
  projectId                               BigInt?
  buildingId                              BigInt?
  subdivisionId                           BigInt?
  userId                                  BigInt
  type                                    media_type
  url                                     String       @db.VarChar(500)
  path                                    String?      @db.VarChar(500)
  order                                   Int?         @default(0)
  createdAt                               DateTime?    @default(now()) @db.Timestamptz(6)
  updatedAt                               DateTime?    @default(now()) @db.Timestamptz(6)
  Building                                Building?    @relation(fields: [buildingId], references: [buildingId], onDelete: NoAction, onUpdate: NoAction)
  Project_Media_projectIdToProject        Project?     @relation("Media_projectIdToProject", fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
  Property_Media_propertyIdToProperty     Property?    @relation("Media_propertyIdToProperty", fields: [propertyId], references: [propertyId], onDelete: NoAction, onUpdate: NoAction)
  Subdivision                             Subdivision? @relation(fields: [subdivisionId], references: [subdivisionId], onDelete: NoAction, onUpdate: NoAction)
  User                                    User         @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  Project_Project_primaryMediaIdToMedia   Project[]    @relation("Project_primaryMediaIdToMedia")
  Property_Property_primaryMediaIdToMedia Property[]   @relation("Property_primaryMediaIdToMedia")

  @@index([projectId], map: "idx_media_project")
  @@index([propertyId], map: "idx_media_property")
  @@index([userId], map: "idx_media_user")
}

model Member {
  memberId     BigInt         @id @default(autoincrement())
  userId       BigInt
  roomId       BigInt
  role         String?        @db.VarChar(256)
  status       member_status?
  notification Int?           @default(1)
  createdAt    DateTime?      @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime?      @default(now()) @db.Timestamptz(6)
  ChatRoom     ChatRoom       @relation(fields: [roomId], references: [roomId], onDelete: NoAction, onUpdate: NoAction)
  User         User           @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model Message {
  messageId                                BigInt        @id @default(autoincrement())
  roomId                                   BigInt
  senderId                                 BigInt
  content                                  String
  messageType                              message_type? @default(TEXT)
  isRead                                   Boolean?      @default(false)
  media                                    String?
  metadata                                 Json?
  createdAt                                DateTime?     @default(now()) @db.Timestamptz(6)
  updatedAt                                DateTime?     @default(now()) @db.Timestamptz(6)
  ChatRoom_ChatRoom_lastMessageIdToMessage ChatRoom[]    @relation("ChatRoom_lastMessageIdToMessage")
  ChatRoom_Message_roomIdToChatRoom        ChatRoom      @relation("Message_roomIdToChatRoom", fields: [roomId], references: [roomId], onDelete: NoAction, onUpdate: NoAction)
  User                                     User          @relation(fields: [senderId], references: [userId], onDelete: NoAction, onUpdate: NoAction)

  @@index([roomId], map: "idx_message_room")
  @@index([senderId], map: "idx_message_sender")
}

model News {
  newsId        BigInt       @id @default(autoincrement())
  categoryId    BigInt
  title         String       @db.VarChar(255)
  content       String
  userId        BigInt?
  publishedDate DateTime?    @db.Timestamptz(6)
  status        news_status?
  author        String?      @db.VarChar(100)
  sourceUrl     String?      @db.VarChar(2048)
  source        String?      @db.VarChar(2048)
  projectId     BigInt?
  tags          Json?
  views         Int          @default(0)
  createdAt     DateTime?    @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?    @default(now()) @db.Timestamptz(6)
  Comment       Comment[]
  Category      Category     @relation(fields: [categoryId], references: [categoryId], onDelete: NoAction, onUpdate: NoAction)
  Project       Project?     @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
  User          User?        @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)

  @@index([categoryId], map: "idx_news_category")
  @@index([status], map: "idx_news_status")
}

model Notification {
  notificationId BigInt             @id @default(autoincrement())
  userId         BigInt?
  title          String             @db.VarChar(255)
  content        String
  type           notification_type?
  public         Int?               @default(1)
  isRead         Boolean?           @default(false)
  createdAt      DateTime?          @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?          @default(now()) @db.Timestamptz(6)
  User           User?              @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model OTP {
  otpId       BigInt      @id @default(autoincrement())
  userId      BigInt?
  channel     otp_channel
  from        String?     @db.VarChar(100)
  destination String?     @db.VarChar(255)
  code        String      @db.VarChar(10)
  purpose     otp_purpose
  expiresAt   DateTime    @db.Timestamptz(6)
  delivered   Boolean?    @default(false)
  createdAt   DateTime?   @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime?   @default(now()) @db.Timestamptz(6)
  User        User?       @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model Panorama {
  panoramaId    BigInt       @id @default(autoincrement())
  userId        BigInt
  propertyId    BigInt?
  projectId     BigInt?
  buildingId    BigInt?
  subdivisionId BigInt?
  baseUrl       String?      @db.VarChar(1024)
  basePath      String?      @db.VarChar(2048)
  order         Int?         @default(0)
  location      String?      @db.VarChar(1024)
  latitude      Float?
  longitude     Float?
  createdAt     DateTime?    @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?    @default(now()) @db.Timestamptz(6)
  Building      Building?    @relation(fields: [buildingId], references: [buildingId], onDelete: NoAction, onUpdate: NoAction)
  Project       Project?     @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
  Property      Property?    @relation(fields: [propertyId], references: [propertyId], onDelete: NoAction, onUpdate: NoAction)
  Subdivision   Subdivision? @relation(fields: [subdivisionId], references: [subdivisionId], onDelete: NoAction, onUpdate: NoAction)
  User          User         @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model Payment {
  paymentId             BigInt             @id @default(autoincrement())
  userId                BigInt
  subscriptionId        BigInt?
  listingId             BigInt?
  walletTransactionId   BigInt?
  amount                Float
  amountBeforeTax       Float?
  taxRate               Float              @default(0)
  paymentMethod         payment_method
  paymentStatus         payment_status?    @default(PENDING)
  paymentFor            payment_for?
  description           String?
  time                  DateTime           @db.Timestamptz(6)
  paymentLink           String?
  qrCode                String?
  externalTransactionId String?            @db.VarChar(1024)
  createdAt             DateTime?          @default(now()) @db.Timestamptz(6)
  updatedAt             DateTime?          @default(now()) @db.Timestamptz(6)
  Listing               Listing?           @relation(fields: [listingId], references: [listingId], onDelete: NoAction, onUpdate: NoAction)
  Subscription          Subscription?      @relation(fields: [subscriptionId], references: [subscriptionId], onDelete: NoAction, onUpdate: NoAction)
  User                  User               @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  WalletTransaction     WalletTransaction? @relation(fields: [walletTransactionId], references: [transactionId], onDelete: NoAction, onUpdate: NoAction, map: "fk_payment_wallet_transaction")
}

model Plan {
  planId           BigInt         @id @default(autoincrement())
  name             String         @db.VarChar(255)
  description      String?
  price            Float
  durationDays     Int
  maxListings      Int            @default(1)
  featuredListings Int?           @default(0)
  prioritySupport  Boolean        @default(false)
  status           plan_status    @default(ACTIVE)
  createdAt        DateTime?      @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime?      @default(now()) @db.Timestamptz(6)
  Subscription     Subscription[]
}

model PriceHistory {
  priceHistoryId BigInt    @id @default(autoincrement())
  propertyId     BigInt
  price          Decimal   @db.Decimal(15, 2)
  changeDate     DateTime  @db.Timestamptz(6)
  createdAt      DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime? @default(now()) @db.Timestamptz(6)
  Property       Property  @relation(fields: [propertyId], references: [propertyId], onDelete: NoAction, onUpdate: NoAction)
}

model Project {
  projectId                           BigInt          @id @default(autoincrement())
  name                                String          @db.VarChar(255)
  investorId                          BigInt?
  scale                               Decimal?        @db.Decimal(10, 2)
  density                             String?         @db.VarChar(100)
  numBlocks                           Int?
  description                         String?
  startDate                           DateTime?       @db.Date
  endDate                             DateTime?       @db.Date
  status                              project_status? @default(UPDATING)
  projectType                         project_type?
  primaryMediaId                      BigInt?
  areaPId                             Int?
  areaWId                             Int?
  oldAreaPId                          Int?
  oldAreaDId                          Int?
  oldAreaWId                          Int?
  premiseImage                        String?
  createdAt                           DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt                           DateTime?       @default(now()) @db.Timestamptz(6)
  Building                            Building[]
  Document                            Document[]
  FAQ                                 FAQ[]
  Lead                                Lead[]
  Media_Media_projectIdToProject      Media[]         @relation("Media_projectIdToProject")
  News                                News[]
  Panorama                            Panorama[]
  Investor                            Investor?       @relation(fields: [investorId], references: [investorId], onDelete: NoAction, onUpdate: NoAction)
  Media_Project_primaryMediaIdToMedia Media?          @relation("Project_primaryMediaIdToMedia", fields: [primaryMediaId], references: [mediaId], onDelete: NoAction, onUpdate: NoAction, map: "fk_project_primary_media")
  Property                            Property[]
  Subdivision                         Subdivision[]
  Utility                             Utility[]
}

model Property {
  propertyId                            BigInt                        @id @default(autoincrement())
  userId                                BigInt
  authorizedUserId                      BigInt?
  authorizedAgentId                     BigInt?
  projectId                             BigInt?
  buildingId                            BigInt?
  subdivisionId                         BigInt?
  address                               String
  title                                 String                        @db.VarChar(255)
  floor                                 Int?
  unit                                  String?                       @db.VarChar(64)
  description                           String?
  propertyType                          property_type?
  width                                 Decimal?                      @db.Decimal(5, 2)
  length                                Decimal?                      @db.Decimal(5, 2)
  floors                                Int?
  floorArea                             Decimal?                      @db.Decimal(10, 2)
  buildingArea                          Decimal?                      @db.Decimal(10, 2)
  landArea                              Decimal?                      @db.Decimal(10, 2)
  bedrooms                              Int?
  toilets                               Int?
  status                                property_status?
  direction                             property_direction?
  legalDocumentType                     property_legal_document_type?
  legalDocumentNumber                   String?                       @db.VarChar(64)
  legalStatus                           property_legal_status?
  latitude                              Decimal?                      @db.Decimal(10, 8)
  longitude                             Decimal?                      @db.Decimal(11, 8)
  furniture                             property_furniture?
  streetWidth                           Decimal?                      @db.Decimal(5, 2)
  primaryMediaId                        BigInt?
  usageStatus                           property_usage_status?        @default(OWNER_OCCUPIED)
  areaPId                               Int?
  areaWId                               Int?
  oldAreaPId                            Int?
  oldAreaDId                            Int?
  oldAreaWId                            Int?
  panoramaConfig                        Json?
  createdAt                             DateTime?                     @default(now()) @db.Timestamptz(6)
  updatedAt                             DateTime?                     @default(now()) @db.Timestamptz(6)
  Appointment                           Appointment[]
  Document                              Document[]
  Favorite                              Favorite[]
  Listing                               Listing[]
  Media_Media_propertyIdToProperty      Media[]                       @relation("Media_propertyIdToProperty")
  Panorama                              Panorama[]
  PriceHistory                          PriceHistory[]
  User_Property_authorizedAgentIdToUser User?                         @relation("Property_authorizedAgentIdToUser", fields: [authorizedAgentId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  User_Property_authorizedUserIdToUser  User?                         @relation("Property_authorizedUserIdToUser", fields: [authorizedUserId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  Building                              Building?                     @relation(fields: [buildingId], references: [buildingId], onDelete: NoAction, onUpdate: NoAction)
  Project                               Project?                      @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
  Subdivision                           Subdivision?                  @relation(fields: [subdivisionId], references: [subdivisionId], onDelete: NoAction, onUpdate: NoAction)
  User_Property_userIdToUser            User                          @relation("Property_userIdToUser", fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  Media_Property_primaryMediaIdToMedia  Media?                        @relation("Property_primaryMediaIdToMedia", fields: [primaryMediaId], references: [mediaId], onDelete: NoAction, onUpdate: NoAction, map: "fk_property_primary_media")
  Transaction                           Transaction[]

  @@index([projectId], map: "idx_property_project")
  @@index([status], map: "idx_property_status")
  @@index([propertyType], map: "idx_property_type")
  @@index([userId], map: "idx_property_user")
}

model Subdivision {
  subdivisionId BigInt     @id @default(autoincrement())
  projectId     BigInt?
  name          String     @db.VarChar(255)
  description   String?
  createdAt     DateTime?  @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?  @default(now()) @db.Timestamptz(6)
  Building      Building[]
  Media         Media[]
  Panorama      Panorama[]
  Property      Property[]
  Project       Project?   @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
}

model Subscription {
  subscriptionId    BigInt               @id @default(autoincrement())
  userId            BigInt
  planId            BigInt
  startDate         DateTime             @db.Timestamptz(6)
  endDate           DateTime             @db.Timestamptz(6)
  status            subscription_status? @default(ACTIVE)
  paymentStatus     payment_status?      @default(PENDING)
  goldListingUsed   Int                  @default(0)
  silverListingUsed Int                  @default(0)
  normalListingUsed Int                  @default(0)
  pushCountUsed     Int                  @default(0)
  createdAt         DateTime?            @default(now()) @db.Timestamptz(6)
  updatedAt         DateTime?            @default(now()) @db.Timestamptz(6)
  Payment           Payment[]
  Plan              Plan                 @relation(fields: [planId], references: [planId], onDelete: NoAction, onUpdate: NoAction)
  User              User                 @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

model Suggestion {
  suggestionId BigInt          @id @default(autoincrement())
  text         String
  type         suggestion_type
  matchedCount Int             @default(0)
  foreignKeyId BigInt?
  createdAt    DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime?       @default(now()) @db.Timestamptz(6)
}

model Transaction {
  transactionId                   BigInt              @id @default(autoincrement())
  listingId                       BigInt
  propertyId                      BigInt
  agentId                         BigInt?
  sellerId                        BigInt
  guestId                         BigInt?
  transactionDate                 DateTime            @db.Timestamptz(6)
  price                           Float
  status                          transaction_status? @default(OFFERED)
  effectiveDate                   DateTime?           @db.Timestamptz(6)
  expirationDate                  DateTime?           @db.Timestamptz(6)
  contractDocument                String?
  createdAt                       DateTime?           @default(now()) @db.Timestamptz(6)
  updatedAt                       DateTime?           @default(now()) @db.Timestamptz(6)
  User_Transaction_agentIdToUser  User?               @relation("Transaction_agentIdToUser", fields: [agentId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  User_Transaction_guestIdToUser  User?               @relation("Transaction_guestIdToUser", fields: [guestId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  Listing                         Listing             @relation(fields: [listingId], references: [listingId], onDelete: NoAction, onUpdate: NoAction)
  Property                        Property            @relation(fields: [propertyId], references: [propertyId], onDelete: NoAction, onUpdate: NoAction)
  User_Transaction_sellerIdToUser User                @relation("Transaction_sellerIdToUser", fields: [sellerId], references: [userId], onDelete: NoAction, onUpdate: NoAction)

  @@index([guestId], map: "idx_transaction_guest")
  @@index([listingId], map: "idx_transaction_listing")
  @@index([sellerId], map: "idx_transaction_seller")
}

model User {
  userId                                    BigInt              @id @default(autoincrement())
  email                                     String              @unique @db.VarChar(255)
  passwordHash                              String              @db.VarChar(255)
  fullname                                  String?             @db.VarChar(255)
  phone                                     String?             @db.VarChar(20)
  address                                   String?
  idCardNumber                              String?             @db.VarChar(50)
  idCardType                                user_idcard_type?
  primaryRole                               user_primary_role?
  status                                    user_status?
  ekycVerified                              Int?                @default(0)
  token                                     String?             @db.VarChar(1024)
  expirationDate                            DateTime?           @db.Timestamptz(6)
  resetPasswordOTP                          String?             @db.VarChar(1024)
  resetPasswordOTPExpirationDate            DateTime?           @db.Timestamptz(6)
  lastActive                                DateTime?           @default(now()) @db.Timestamptz(6)
  agentCertificate                          String?
  agentStatus                               user_agent_status?  @default(PENDING)
  idCardDocuments                           Json?
  avatar                                    String?
  idCardPlaceIfIssue                        String?             @db.VarChar(256)
  idCardIssueDate                           DateTime?           @db.Timestamptz(6)
  balance                                   Float?
  lifetimeBalance                           Float?
  createdAt                                 DateTime?           @default(now()) @db.Timestamptz(6)
  updatedAt                                 DateTime?           @default(now()) @db.Timestamptz(6)
  Appointment                               Appointment[]
  Audit                                     Audit[]
  ChatRoom                                  ChatRoom[]
  Comment                                   Comment[]
  Device                                    Device[]
  Document                                  Document[]
  Favorite                                  Favorite[]
  Feedback                                  Feedback[]
  Lead                                      Lead[]
  Listing                                   Listing[]
  Media                                     Media[]
  Member                                    Member[]
  Message                                   Message[]
  News                                      News[]
  Notification                              Notification[]
  OTP                                       OTP[]
  Panorama                                  Panorama[]
  Payment                                   Payment[]
  Property_Property_authorizedAgentIdToUser Property[]          @relation("Property_authorizedAgentIdToUser")
  Property_Property_authorizedUserIdToUser  Property[]          @relation("Property_authorizedUserIdToUser")
  Property_Property_userIdToUser            Property[]          @relation("Property_userIdToUser")
  Subscription                              Subscription[]
  Transaction_Transaction_agentIdToUser     Transaction[]       @relation("Transaction_agentIdToUser")
  Transaction_Transaction_guestIdToUser     Transaction[]       @relation("Transaction_guestIdToUser")
  Transaction_Transaction_sellerIdToUser    Transaction[]       @relation("Transaction_sellerIdToUser")
  WalletTransaction                         WalletTransaction[]

  @@index([email], map: "idx_user_email")
  @@index([phone], map: "idx_user_phone")
  @@index([status], map: "idx_user_status")
}

model Utility {
  utilityId   BigInt        @id @default(autoincrement())
  projectId   BigInt?
  name        String        @db.VarChar(255)
  type        utility_type?
  description String?
  createdAt   DateTime?     @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime?     @default(now()) @db.Timestamptz(6)
  Project     Project?      @relation(fields: [projectId], references: [projectId], onDelete: NoAction, onUpdate: NoAction)
}

model WalletTransaction {
  transactionId BigInt          @id @default(autoincrement())
  userId        BigInt
  amount        Float
  endingBalance Float
  paymentMethod payment_method
  status        payment_status? @default(PENDING)
  description   String?
  createdAt     DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?       @default(now()) @db.Timestamptz(6)
  Payment       Payment[]
  User          User            @relation(fields: [userId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
}

enum appointment_status {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum area_type {
  C
  P
  D
  W
}

enum audit_action {
  CREATE
  UPDATE
  DELETE
}

enum comment_status {
  PENDING
  APPROVED
  REJECTED
}

enum document_legal_type {
  SO_HONG
  HDMB
  OTHER
}

enum document_type {
  PDF
  DOCX
  IMAGE
  OTHER
}

enum faq_category {
  PLAN
  PROJECT
  PAYMENT
  ACCOUNT
}

enum faq_status {
  ACTIVE
  INACTIVE
}

enum favorite_type {
  PROPERTY
  LISTING
  NEWS
}

enum lead_status {
  NEW
  CONTACTED
  QUALIFIED
  LOST
}

enum listing_credit_source {
  PAYMENT
  WALLET
  SUBSCRIPTION
}

enum listing_status {
  PENDING
  REVIEWING
  ACTIVE
  INACTIVE
  SOLD
  RENTED
  EXPIRED
  REJECTED
}

enum listing_type {
  FOR_SALE
  FOR_RENT
}

enum media_type {
  IMAGE
  VIDEO
  D        @map("3D")
  PANORAMA
}

enum member_status {
  INVITED
  JOINED
  REQUESTED
  BLOCKED
}

enum message_type {
  TEXT
  IMAGE
  VIDEO
  FILE
}

enum news_status {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum notification_type {
  NEWS
  SYSTEM
  PROMOTION
  TRANSACTION
  APPOINTMENT
  LISTING
  PROJECT
  PROPERTY
}

enum otp_channel {
  SMS
  EMAIL
  ZALO
}

enum otp_purpose {
  REGISTER
  LOGIN
  TRANSACTION
  CHANGE_PASSWORD
}

enum payment_for {
  SUBSCRIPTION
  LISTING
  TOPUP
}

enum payment_method {
  CASH
  VNPAY
  MOMO
  QR
}

enum payment_status {
  PENDING
  COMPLETED
  FAILED
}

enum plan_status {
  ACTIVE
  INACTIVE
}

enum project_status {
  UPDATING
  OPENNING
  COMPLETED
}

enum project_type {
  APARTMENT
  OFFICE
  MALL
  NEW_URBAN
  COMPLEX
  SOCIAL_HOUSING
  RESORT
  INDUSTRIAL_PARK
  TOWN_HOUSE
  SHOPHOUSE
  STREETFRONT
  OTHER
}

enum property_direction {
  NORTH
  SOUTH
  EAST
  WEST
  NORTHEAST
  SOUTHEAST
  NORTHWEST
  SOUTHWEST
}

enum property_furniture {
  BASIC
  FULL
  NONE
}

enum property_legal_document_type {
  SO_HONG
  HDMB
  OTHER
}

enum property_legal_status {
  LEGAL
  PLANNING_ISSUES
  UNDETERMINED
  REVOKED
  NON_EXISTENT
}

enum property_status {
  DRAFT
  PENDING
  REVIEWING
  APPROVED
  REJECTED
}

enum property_type {
  APARTMENT
  MINI_APARTMENT
  HOUSE
  VILLA
  STREETFRONT
  COMMERCIAL
  LAND_PROJECT
  LAND_SALE
  CONDOTEL
  WAREHOUSE
  OTHER
}

enum property_usage_status {
  OWNER_OCCUPIED
  FOR_RENT
  RENTED
}

enum subscription_status {
  ACTIVE
  EXPIRED
  CANCELLED
}

enum suggestion_type {
  PROPERTY
  LISTING
  PROJECT
  AREA
  NEWS
  OTHER
}

enum transaction_status {
  OFFERED
  ACCEPTED
  COMPLETED
  CANCELLED
}

enum user_agent_status {
  PENDING
  VERIFIED
}

enum user_idcard_type {
  CC
  PASSPORT
}

enum user_primary_role {
  USER
  AGENT
  ADMIN
}

enum user_status {
  REGISTERED
  ACTIVE
  BANNED
  DELETED
}

enum utility_type {
  AMENITY
  SERVICE
  FACILITY
}
